var ams=ams||{};ams.Utils={tid:null,isHomologationEnvironment:function(){return window.location.pathname.includes("homologation")||window.location.hostname=='127.0.0.1'},setMapHeight:function(){$('#map').height(window.innerHeight-$('footer.footer').height()-$('#content').height())},onWindowResize:function(){ams.Utils.tid&&window.clearTimeout(ams.Utils.tid),ams.Utils.tid=window.setTimeout(()=>{ams.Utils.tid=null,ams.Utils.setMapHeight(),ams.App._onWindowResize()},200)},getServerConfigParam:function(a){return $('meta[name="'+a+'"]').attr('content')},startApp:function(a){var b,c,d,e;if(typeof a=='undefined'){let a=localStorage.getItem('ams.previous.biome.setting.selection');ams.Utils.biomeChanges(a!==null?a:ams.defaultBiome)}else{ams.Auth.evaluate(),ams.Utils.setMapHeight(),b=JSON.parse(a.spatial_units_info.replace(/'/g,'"')),ams.Config=ams.BiomeConfig[a.appBiome],ams.Config.biome=a.appBiome,ams.Config.landUses=JSON.parse(a.land_uses.replace(/'/g,'"')),c=new ams.Map.SpatialUnits(b,ams.Config.defaultFilters.spatialUnit),d=new ams.Map.AppClassGroups(JSON.parse(a.deter_class_groups.replace(/'/g,'"'))),e=a.geoserver_url;try{ams.App.run(e,c,d)}catch(a){console.log(a),ams.Utils.resetlocalStorage()}}},restartApp:function(){Authentication.eraseCookie(Authentication.tokenKey);var a=$('#map');a&&(a.remove(),$('#panel_container').append("<div id='map'>")),ams.Utils.setMapHeight(),ams.Utils.startApp()},biomeChanges:function(a){const b=new Promise((b,c)=>{async function d(d){let a=await fetch("biome/config?targetbiome="+d);if(a&&a.ok){let e=await a.json();e.appBiome?(localStorage.setItem('ams.biome.config.'+d,JSON.stringify(e)),localStorage.setItem('ams.config.created.at',(new Date).toISOString().split('T')[0]),ams.Utils.startApp(e),b()):(console.log("HTTP-Error: "+a.status+" on biome changes"),$('.toast').toast('show'),$('.toast-body').html("Encontrou um erro na solicitação ao servidor."),c("HTTP-Error: "+a.status+" on biome changes"))}else a&&console.log("HTTP-Error: "+a.status+" on biome changes"),$('.toast').toast('show'),$('.toast-body').html("Encontrou um erro na solicitação ao servidor."),c("HTTP-Error: "+a.status+" on biome changes")}delete ams.Map.PopupControl._popupReference,ams.Map.PopupControl._infoBody=[];let e=$('#map');if(e&&(e.remove(),$('#panel_container').append("<div id='map'>")),ams.Utils.setMapHeight(),ams.Auth.resetWorkspace(),localStorage.getItem('ams.biome.config.'+a)!==null&&localStorage.getItem('ams.config.created.at')!==null){let c=new Date(localStorage.getItem('ams.config.created.at')+'T03:00:00.000Z'),e=new Date((new Date).toISOString().split('T')[0]+'T03:00:00.000Z');if(c<e){for(let a in ams.BiomeConfig)ams.BiomeConfig.hasOwnProperty(a)&&localStorage.removeItem('ams.biome.config.'+a);d(a)}else{let c=JSON.parse(localStorage.getItem('ams.biome.config.'+a));ams.Utils.startApp(c),b()}}else d(a)});return b},numberFormat:function(a){a=a+'';let b=a.split('.');return b.length==2?parseFloat(a).toFixed(ams.Config.floatDecimals):parseInt(a)},resetlocalStorage:function(){localStorage.clear()},assert:function(a,b){if(!a)throw new Error(b||"assertion error")}}