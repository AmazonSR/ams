var ams=ams||{};ams.Utils={tid:null,isHomologationEnvironment:function(){return window.location.pathname.includes("homologation")||"127.0.0.1"==window.location.hostname},setMapHeight:function(){$("#map").height(window.innerHeight-$("footer.footer").height()-$("#content").height())},onWindowResize:function(){ams.Utils.tid&&window.clearTimeout(ams.Utils.tid),ams.Utils.tid=window.setTimeout(()=>{ams.Utils.tid=null,ams.Utils.setMapHeight(),ams.App._onWindowResize()},200)},startApp:function(generalConfig){if(void 0===generalConfig){let b=localStorage.getItem("ams.previous.biome.setting.selection");ams.Utils.biomeChanges(null!==b?b:ams.defaultBiome)}else{ams.Auth.evaluate(),ams.Utils.setMapHeight();var sus=JSON.parse(generalConfig.spatial_units_info.replace(/'/g,'"'));ams.Config=ams.BiomeConfig[generalConfig.appBiome],ams.Config.biome=generalConfig.appBiome,ams.Config.landUses=JSON.parse(generalConfig.land_uses.replace(/'/g,'"'));var spatialUnits=new ams.Map.SpatialUnits(sus,ams.Config.defaultFilters.spatialUnit),appClassGroups=new ams.Map.AppClassGroups(JSON.parse(generalConfig.deter_class_groups.replace(/'/g,'"'))),geoserverUrl=generalConfig.geoserver_url;try{ams.App.run(geoserverUrl,spatialUnits,appClassGroups)}catch(error){console.log(error),ams.Utils.resetlocalStorage()}}},restartApp:function(){Authentication.eraseCookie(Authentication.tokenKey);var mapDiv=$("#map");mapDiv&&(mapDiv.remove(),$("#panel_container").append("<div id='map'>")),ams.Utils.setMapHeight(),ams.Utils.startApp()},biomeChanges:function(selectedBiome){async function getConfigByBiome(selectedBiome){let response=await fetch("biome/config?targetbiome="+selectedBiome);if(response&&response.ok){let generalConfig=await response.json();generalConfig.appBiome?(localStorage.setItem("ams.biome.config."+selectedBiome,JSON.stringify(generalConfig)),localStorage.setItem("ams.config.created.at",(new Date).toISOString().split("T")[0]),ams.Utils.startApp(generalConfig)):(console.log("HTTP-Error: "+response.status+" on biome changes"),$(".toast").toast("show"),$(".toast-body").html("Encontrou um erro na solicitação ao servidor."))}else response&&console.log("HTTP-Error: "+response.status+" on biome changes"),$(".toast").toast("show"),$(".toast-body").html("Encontrou um erro na solicitação ao servidor.")}delete ams.Map.PopupControl._popupReference,ams.Map.PopupControl._infoBody=[];let mapDiv=$("#map");if(mapDiv&&(mapDiv.remove(),$("#panel_container").append("<div id='map'>")),ams.Utils.setMapHeight(),ams.Auth.resetWorkspace(),null!==localStorage.getItem("ams.biome.config."+selectedBiome)&&null!==localStorage.getItem("ams.config.created.at")){let createdAt,nowDate;if(new Date(localStorage.getItem("ams.config.created.at")+"T03:00:00.000Z")<new Date((new Date).toISOString().split("T")[0]+"T03:00:00.000Z")){for(let p in ams.BiomeConfig)ams.BiomeConfig.hasOwnProperty(p)&&localStorage.removeItem("ams.biome.config."+p);getConfigByBiome(selectedBiome)}else{let biomeConfiguration=JSON.parse(localStorage.getItem("ams.biome.config."+selectedBiome));ams.Utils.startApp(biomeConfiguration)}}else getConfigByBiome(selectedBiome)},numberFormat:function(n){let sp;return 2==(n+="").split(".").length?parseFloat(n).toFixed(ams.Config.floatDecimals):parseInt(n)},resetlocalStorage:function(){localStorage.clear()}};