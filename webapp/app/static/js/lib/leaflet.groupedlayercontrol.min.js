L.Control.GroupedLayers=L.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,exclusiveGroups:[],groupCheckboxes:!1},initialize:function(controlGroups,options){var i,j;for(i in L.Util.setOptions(this,options),this._ctrls=[],this._groupList=[],this._domGroups=[],controlGroups)for(j in controlGroups[i])"defaultFilter"!=j&&"propertyName"!=j&&this._addControl(controlGroups[i][j],j,i,controlGroups[i].defaultFilter,!0)},onAdd:function(map){return this._initLayout(map),this._update(),this._container},onRemove:function(map){},_getControlById:function(id){for(var i=0;i<this._ctrls.length;i++)if(this._ctrls[i]&&this._ctrls[i].ctrlId===id)return this._ctrls[i]},_initLayout:function(map){var className="leaflet-control-layers",container=this._container=L.DomUtil.create("div",className);container.setAttribute("aria-haspopup",!0),$(container).mouseenter((function(){map.dragging.disable(),map.scrollWheelZoom.disable(),map.doubleClickZoom.disable()})),$(container).mouseleave((function(){map.dragging.enable(),map.scrollWheelZoom.enable(),map.doubleClickZoom.enable()})),L.Browser.touch?L.DomEvent.on(container,"click",L.DomEvent.stopPropagation):(L.DomEvent.disableClickPropagation(container),L.DomEvent.on(container,"wheel",L.DomEvent.stopPropagation));var form=this._form=L.DomUtil.create("form",className+"-list");if(this._baseLayersList=L.DomUtil.create("div",className+"-base",form),this._separator=L.DomUtil.create("div",className+"-separator",form),this._overlaysList=L.DomUtil.create("div",className+"-overlays",form),container.appendChild(form),this.options.collapsed){L.Browser.android||L.DomEvent.on(container,"mouseover",this._expand,this).on(container,"mouseout",this._collapse,this);var link=this._layersLink=L.DomUtil.create("a",className+"-toggle",container);link.href="#",link.title="Layers",L.Browser.touch?L.DomEvent.on(link,"click",L.DomEvent.stop).on(link,"click",this._expand,this):L.DomEvent.on(link,"focus",this._expand,this),this._map.on("click",this._collapse,this)}else this._expand()},_addControl:function(acronym,name,group,defaultFilter,overlay){var _ctrl={acronym:acronym,name:name,defaultFilter:defaultFilter,overlay:overlay};_ctrl.ctrlId=L.Util.stamp(_ctrl),this._ctrls.push(_ctrl),group=group||"";var groupId=this._indexOf(this._groupList,group);-1===groupId&&(groupId=this._groupList.push(group)-1);var exclusive=-1!==this._indexOf(this.options.exclusiveGroups,group);_ctrl.group={name:group,id:groupId,exclusive:exclusive}},_update:function(){if(!this._container)return;this._baseLayersList.innerHTML="",this._overlaysList.innerHTML="",this._domGroups.length=0;for(var baseLayersPresent=!1,overlaysPresent=!1,i,obj,i=0;i<this._ctrls.length;i++)obj=this._ctrls[i],this._addItem(obj),overlaysPresent=overlaysPresent||obj.overlay,baseLayersPresent=baseLayersPresent||!obj.overlay;let dctrl=this._getDownloadControlDOM();this._overlaysList.appendChild(dctrl),this._separator.style.display=overlaysPresent&&baseLayersPresent?"":"none"},_createInputElement:function(name,type,checked){var inputHtml='<input type="'+type+'" class="leaflet-control-layers-selector" name="'+name+'"';checked&&(inputHtml+=' checked="checked"'),inputHtml+="/>";var inputFragment=document.createElement("div");return inputFragment.innerHTML=inputHtml,inputFragment.firstChild},_createProfileBiomeButton:function(biome){let biomeId,bt='<button title="Visualize o perfil para todo o bioma." class="btn btn-primary-p profile-bt" id="profile-'+ams.BiomeConfig[biome].defaultWorkspace+'-button"><i class="material-icons profile-bt-icon">leaderboard</i>Perfil</button>';var btFragment=document.createElement("div");return btFragment.innerHTML=bt,btFragment},_addItem:function(obj){var label=document.createElement("label"),input,checked="USO DA TERRA"==obj.group.name?obj.defaultFilter.includes(obj.acronym):obj.acronym.includes(obj.defaultFilter),container,groupRadioName,profileBt=null,type="USO DA TERRA"==obj.group.name?"checkbox":"radio";groupRadioName="leaflet-exclusive-group-layer-"+obj.group.id,(input=this._createInputElement(groupRadioName,type,checked)).ctrlId=obj.ctrlId,input.groupID=obj.group.id,L.DomEvent.on(input,"click",this._onInputClick,this);var name=document.createElement("span");if(name.innerHTML=" "+obj.name,"BIOMA"==obj.group.name){let divbiome=document.createElement("div");divbiome.appendChild(input),divbiome.appendChild(name),label.appendChild(divbiome),label.className="leaflet-biome-control-item",checked&&(profileBt=this._createProfileBiomeButton(obj.name),label.appendChild(profileBt))}else label.appendChild(input),label.appendChild(name);if(obj.overlay){container=this._overlaysList;var groupContainer=this._domGroups[obj.group.id];if(!groupContainer){(groupContainer=document.createElement("div")).className="leaflet-control-layers-group",groupContainer.id="leaflet-control-layers-group-"+obj.group.id,groupContainer.title=this._getTitleByGroup(obj.group.name),"UNIDADE TEMPORAL"==obj.group.name&&(groupContainer.style="display:none;");var groupLabel=document.createElement("label");groupLabel.className="leaflet-control-layers-group-label";var groupName=document.createElement("span");if(groupName.className="leaflet-control-layers-group-name",groupName.innerHTML=obj.group.name,groupLabel.appendChild(groupName),groupContainer.appendChild(groupLabel),container.appendChild(groupContainer),"UNIDADE ESPACIAL"==obj.group.name){let pctrl=this._getPriorityControlDOM();container.appendChild(pctrl)}this._domGroups[obj.group.id]=groupContainer}container=groupContainer}else container=this._baseLayersList;return container.appendChild(label),label},_getTitleByGroup:function(grpName){let title="";switch(grpName){case"BIOMA":title="Alterna entre as bases de dados dos biomas disponíveis.";break;case"INDICADOR":title="Aplica um filtro com base nas classes dos dados do DETER e focos do Programa Queimadas, sendo:\n";for(let index=0;index<ams.App._appClassGroups.groups.length;index++){const group=ams.App._appClassGroups.groups[index];title+=" - "+group.name+": "+group.classes.join(", ")+";\n"}break;case"UNIDADE ESPACIAL":title="Alterna entre as unidades espaciais disponíveis.";break;case"USO DA TERRA":title='Aplica um filtro com base nas categorias de "USO DA TERRA" selecionadas.';break;case"CLASSIFICAÇÃO DO MAPA":title='A opção "No Período" destaca as unidades espaciais por intervalos de valor, com destaque para os maiores valores absolutos.\n\n',title+='A opção "Diferença Período Anterior" destaca as unidades espaciais por intervalos de valor, considerando a diferença de valor entre o período selecionado e o período anterior.\n',title+=" - Destaque em tons de vermelho indicam aumento do valor no período corrente em relação ao período anterior.\n",title+=" - Destaque em tons de azul indicam diminuição do valor no período corrente em relação ao período anterior.\n"}return title},_getPriorityControlDOM:function(){let fctrl=document.createElement("div"),title='title="Altera o número de unidades espaciais consideradas na priorização de exibição do mapa.\n';return title+='Irá destacar, com borda vermelha, as unidades espaciais com maior valor agregado para o período." ',fctrl.innerHTML='<div class="leaflet-control-layers-group" id="prioritization-control-layers-group"><label class="leaflet-control-layers-group-name" '+title+'><span class="leaflet-control-layers-group-name">Prioriza&#231;&#227;o </span><input type="number" id="prioritization-input" min="1" style="width:45px" '+title+"value="+ams.App._priorViewParams.limit+' /><button class="btn btn-primary-p" id="prioritization-button" style="margin-left: 10px;"> Ok </button></label></div>',fctrl.firstChild},_getDownloadControlDOM:function(){let fctrl=document.createElement("div"),title='title="O arquivo inclui dados filtrados por: BIOMA, INDICADOR e PERÍODO.\n';return title+=" - CSV: inclui apenas as unidades espaciais priorizadas;\n",title+=' - Shapefile: inclui todas as unidades espaciais;" ',fctrl.innerHTML='<div class="leaflet-control-layers-group" id="shapezip-control-layers-group"><label class="leaflet-control-layers-group-label"><span class="leaflet-control-layers-group-name">DOWNLOAD</span></label><label class="leaflet-control-layers-group-name" '+title+'><span style="white-space: pre-wrap;">Baixar arquivo da unidade<br>espacial selecionada.</span></label><label class="leaflet-control-layers-group-name btn-download"><button class="btn btn-primary-p btn-success" id="csv-download-button"> CSV </button>&nbsp;&nbsp;<button class="btn btn-primary-p btn-success" id="shapezip-download-button"> Shapefile </button></label></div>',fctrl.firstChild},_onInputClick:function(e){let obj=this._getControlById(e.target.ctrlId);this._map.fire("changectrl",obj)},_expand:function(){L.DomUtil.addClass(this._container,"leaflet-control-layers-expanded"),L.DomUtil.addClass(this._form,"leaflet-control-layers-scrollbar"),this._form.style.height="auto"},_onWindowResize:function(){var acceptableHeight=$("#map").height()-2*this._container.offsetTop;this._form.scrollHeight>acceptableHeight?this._form.style.height=acceptableHeight+"px":this._form.style.height="auto"},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-layers-expanded","")},_indexOf:function(arr,obj){for(var i=0,j=arr.length;i<j;i++)if(arr[i]===obj)return i;return-1}}),L.control.groupedLayers=function(controlGroups,options){return new L.Control.GroupedLayers(controlGroups,options)};